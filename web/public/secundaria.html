<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transacciones</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
    <div class="container py-5">
        <div class="card shadow">
            <div class="card-body">
                <h2 class="mb-4 text-center">Panel de Transacciones</h2>
                <p class="mb-4 text-center">Realiza transferencias entre cuentas de forma segura y sencilla.</p>
                <form id="form-mensaje">
                    <div class="row mb-3">
                        <div class="col-md-4 mb-2 mb-md-0">
                            <input type="text" id="origen" class="form-control" placeholder="Cuenta origen" required>
                        </div>
                        <div class="col-md-4 mb-2 mb-md-0">
                            <input type="text" id="destino" class="form-control" placeholder="Cuenta destino" required>
                        </div>
                        <div class="col-md-4">
                            <input type="number" id="cantidad" class="form-control" placeholder="Cantidad transferida" required>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center">
                        <button type="submit" class="btn btn-success">Realizar transacción</button>
                        <button type="button" class="btn btn-danger ms-2" id="cerrar-sesion">Cerrar sesión</button>
                    </div>
                </form>
                <div class="mt-4">
                    <h5>Estado de la transacción:</h5>
                    <pre id="respuesta" class="bg-white p-3 border"></pre>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Obtener usuario y clave del almacenamiento local
        const usuario = localStorage.getItem('usuario');
        const clave = localStorage.getItem('clave');
        if (!usuario || !clave) {
            window.location.href = 'login.html';
        }
        document.getElementById('form-mensaje').addEventListener('submit', async function(e) {
            e.preventDefault();
            const origen = document.getElementById('origen').value;
            const destino = document.getElementById('destino').value;
            const cantidad = document.getElementById('cantidad').value;
            const mensajeTransaccion = `${origen}, ${destino}, ${cantidad}`;
            const res = await fetch('/api/send', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ usuario, clave, mensaje: mensajeTransaccion })
            });
            const data = await res.json();
            let mensajeRespuesta = data.respuesta || data.error;
            if (mensajeRespuesta) mensajeRespuesta = mensajeRespuesta.replace(/§/g, '');
            document.getElementById('respuesta').textContent = mensajeRespuesta;
        });
        document.getElementById('cerrar-sesion').addEventListener('click', function() {
            localStorage.removeItem('usuario');
            localStorage.removeItem('clave');
            window.location.href = 'login.html';
        });
    </script>
</body>
</html>
